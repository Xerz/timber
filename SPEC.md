# Техзадание: стартовый экран (Tauri)

**Контекст и цель**
Сделать лаунчер с плитками игр «как на сайте» (допускаются отличия hover‑подсветки). Данные берутся по API, карточки кликабельны и запускают игру, кроме Desktop (закрывает лаунчер). Реализация: Tauri 2 (Rust backend + web UI). Нужна возможность разработки и UI‑тестов на macOS.

**Ключевое решение по UI**
Используем HTML/CSS и подключаем внешний CSS сайта `https://drova.io/index.min.css` для максимального сходства. Дополнительные стили — локально.

**Объем работ (MVP)**
- Получение токена и UUID станции (Windows Registry, на macOS — env‑переменные для разработки).
- Запрос списка доступных игр и фильтрация `enabled && available`.
- Запрос параметров запуска для каждой игры.
- Запрос справочника продуктов (картинки, метаданные).
- Рендеринг плиток и интерактивность (hover, click).
- Показ прогресса загрузки.
- Запуск игры при клике и выход из лаунчера.

**Требования к данным**
- Реестр:
  - `HKLM\SOFTWARE\ITKey\Esme` ключ `last_server` -> `station_uuid`.
  - `HKLM\SOFTWARE\ITKey\Esme\servers\{station_uuid}` ключ `auth_token` -> `token`.
- API:
  - Список игр: `GET https://services.drova.io/server-manager/serverproduct/list4edit2/{station_uuid}`
  - Параметры запуска: `GET https://services.drova.io/server-manager/serverproduct/list4edit2/{station_uuid}/{productId}`
  - Каталог продуктов: `GET https://services.drova.io/product-manager/product/listfull2?limit=2000`
- Заголовок авторизации: `X-Auth-Token: <token>`

**Правила отбора игр**
- Игра отображается, если `enabled == true` и `available == true`.

**Правила отображения карточки**
- Фоновая картинка: `cardPicture`.
- Заголовок: `displayName` (fallback: `title`).
- Alt/tooltip: первые 100 символов `descriptionRu`.
- Бейдж `requiredAccount` показывается, если поле не `null`.
- Бейдж “Бесплатная” показывается, если `noLicenseRequred == true`.
- Если картинка недоступна — показывать плейсхолдер.

**Правила запуска**
- При клике на карточку:
  - визуально показать факт выбора,
  - закрыть окно лаунчера,
  - запустить программу (кроме Desktop),
  - завершить скрипт (не дожидаясь выхода игры).
- Используемые поля запуска:
  - `gamePath` если задан, иначе `defaultGamePath`.
  - `workPath` если задан, иначе `defaultWorkPath`.
  - `args` если задан, иначе `defaultArgs`.
- Desktop:
  - если продукт является Desktop (`useDefaultDesktop == true` или `title == Desktop` / `displayName == Рабочий стол`) — **не** запускать exe, просто закрыть лаунчер.

**Состояния UI**
- Инициализация: “Получаем токен и UUID станции…”
- Загрузка списка игр: “Загружаем список игр…”
- Загрузка ресурсов: “Загружаем ресурсы X/N…”
- Готово: скрыть индикатор.
- Ошибка: показать сообщение и кнопку “Повторить”, вывести fallback‑карточку Desktop.

**Кэширование**
- Кэш изображений `cardPicture` в локальной папке (временная директория `drova-launcher/images`).
- TTL кэша: 24 часа.

**Архитектура**
- Rust (Tauri):
  - Реестр, HTTP, кэш, сборка карточек.
  - Команды `load_cards` и `launch_game`.
  - События прогресса через `app.emit("status")`.
- UI (HTML/CSS/JS):
  - Отрисовка карточек.
  - Слушатель статусов.
  - Вызов `load_cards` и `launch_game` через Tauri API.

**Совместимость с разработкой на macOS**
- UI тестируется через `?mock=1` и Playwright.
- Бэкенд на macOS можно запускать при наличии `DROVA_STATION_UUID` и `DROVA_AUTH_TOKEN`.
- Поддерживается `.env` файл (dotenv).

**Критерии приемки (MVP)**
- Плитки отображаются как на сайте и реагируют на hover.
- При клике запускается `exe` (кроме Desktop) и лаунчер закрывается.
- Во время загрузки виден прогресс.
- Desktop закрывает лаунчер без запуска exe.
